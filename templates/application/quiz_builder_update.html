{% extends 'application/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block base_title %}Quiz Builder{% endblock %}

{% block base_links %}
    <!-- XDSoft DateTimePicker -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css"
          integrity="sha256-DOS9W6NR+NFe1fUhEE0PGKY/fubbUCnOfTje2JMDw3Y=" crossorigin="anonymous"/>
{% endblock %}

{% block page_heading %}
    Quiz : {{ quiz_title }}<br><br>
    {#    <p class="m-0 small text-white bg-danger p-2 my-2"><b>WARNING: </b>don't delete this quiz if this is attempted by#}
    {#        anyone.</p>#}
    <a href="{% url 'application:delete_quiz' quiz_id %}" class="btn btn-sm btn-link text-danger"><i
            class="fa fa-trash"></i> Remove</a>
    <a href="{% url 'application:update_quiz' quiz_id %}" class="btn btn-sm btn-link text-primary"><i
            class="fa fa-edit"></i> Edit</a>
    <a href="{% url 'application:quiz_builder' %}" class="btn btn-sm btn-link text-primary"><i
            class="fa fa-plus"></i> Add New</a>

{% endblock %}


{% block content %}


    {# MAIN DIVISION #}
    <div class="">

        {% if questionDS %}
            {% for q in questionDS %}
                <div class="card">
                    <div class="card-body">

                        {# QUESTION-MAIN HEADER ----------------------------------------------------------------- #}
                        <div class="table-responsive">
                            <table class="table table-borderless table-nowrap mb-0">
                                <tbody id="submission_control_body">

                                <tr>
                                    <td>
                                        SNO ({{ q.id }})
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input"
                                                   id="question{{ q.pk }}">
                                            <label class="custom-control-label"
                                                   for="customCheck3">Question {{ forloop.counter }}</label>
                                        </div>
                                    </td>
                                    <td>
                                        Subject
                                        <h5 class="text-truncate font-size-14 m-0"><a href="#"
                                                                                      class="text-dark">{{ q.subject }}</a>
                                        </h5>
                                    </td>
                                    <td>
                                        Level<br>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>

                                    </td>
                                    <td>
                                        Age Limit
                                        <h5 class="text-truncate font-size-14 m-0"><a href="#"
                                                                                      class="text-dark">{{ q.age_limit }}</a>
                                        </h5>
                                    </td>
                                    <td class="">
                                        Submission Control
                                        <div class="">

                                            <input type="radio"
                                                   name="submission_control_{{ q.id }}" id="submission_control"
                                                   value="1"
                                                   data-questionid="{{ q.id }}"
                                                   {% if q.submission_control.no == 1 %}checked="checked"{% endif %}
                                            > Screen 1

                                            {% if players == '2' or players == '3' %}
                                                <input type="radio"
                                                       name="submission_control_{{ q.id }}" id="submission_control"
                                                       value="2"
                                                       data-questionid="{{ q.id }}"
                                                       {% if q.submission_control.no == 2 %}checked{% endif %}
                                                > Screen 2
                                            {% endif %}

                                            {% if players == '3' %}
                                                <input type="radio"
                                                       name="submission_control_{{ q.id }}" id="submission_control"
                                                       value="3"
                                                       data-questionid="{{ q.id }}"
                                                       {% if q.submission_control.no == 3 %}checked{% endif %}
                                                >
                                            {% endif %}

                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        </div>

                        {# QUESTION-DESC ------------------------------------------------------------------------ #}
                        <div id="desc-div">
                            <div class="table-responsive">
                                <table class="table table-borderless">
                                    <tr class="border-top">
                                        <th>Statement</th>
                                        <th>Screen 1</th>
                                        {% if players == '2' or players == '3' %}
                                            <th>Screen 2</th>
                                        {% endif %}
                                        {% if players == '3' %}
                                            <th>Screen 3</th>
                                        {% endif %}
                                    </tr>

                                    {# CHOICES #}
                                    {% for desc in q.statements %}
                                        <tr>
                                            <td>{{ desc.description }}</td>
                                            <td>
                                                <input type="checkbox" id="statement_control" data-question="{{ q.id }}"
                                                       data-statement="{{ desc.id }}"
                                                {% if desc.screen1 %} checked {% endif %} data-screen="1">
                                            </td>

                                            {% if players == '2' or players == '3' %}
                                                <td>
                                                    <input type="checkbox" id="statement_control" data-question="{{ q.id }}"
                                                       data-statement="{{ desc.id }}"
                                                {% if desc.screen2 %} checked {% endif %} data-screen="2">
                                                </td>
                                            {% endif %}

                                            {% if players == '3' %}
                                                <td>
                                                    <input type="checkbox" id="statement_control" data-question="{{ q.id }}"
                                                       data-statement="{{ desc.id }}"
                                                {% if desc.screen3 %} checked {% endif %} data-screen="3">
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}

                                    <tr class="border-top">
                                        <th>Choice</th>
                                        <th>Screen 1</th>
                                        {% if players == '2' or players == '3' %}
                                            <th>Screen 2</th>
                                        {% endif %}
                                        {% if players == '3' %}
                                            <th>Screen 3</th>
                                        {% endif %}
                                    </tr>

                                    {# CHOICES #}
                                    {% for desc in q.choices %}
                                        <tr>
                                            <td>{{ desc.description }}</td>
                                            <td>
                                                <input type="checkbox" id="choice_control" data-question="{{ q.id }}"
                                                       data-choice="{{ desc.id }}"
                                                {% if desc.screen1 %} checked {% endif %} data-screen="1">
                                            </td>

                                            {% if players == '2' or players == '3' %}
                                                <td>
                                                    <input type="checkbox" id="choice_control" data-question="{{ q.id }}"
                                                       data-choice="{{ desc.id }}"
                                                {% if desc.screen2 %} checked {% endif %} data-screen="2">
                                                </td>
                                            {% endif %}

                                            {% if players == '3' %}
                                                <td>
                                                    <input type="checkbox" id="choice_control" data-question="{{ q.id }}"
                                                       data-choice="{{ desc.id }}"
                                                {% if desc.screen3 %} checked {% endif %} data-screen="3">
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}

                                    <tr class="border-top">
                                        <th>Image</th>
                                        <th>Screen 1</th>
                                        {% if players == '2' or players == '3' %}
                                            <th>Screen 2</th>
                                        {% endif %}
                                        {% if players == '3' %}
                                            <th>Screen 3</th>
                                        {% endif %}
                                    </tr>
                                    {# IMAGE #}
{#                                    {% for v in '123'|make_list %}#}
{#                                        <tr>#}
{#                                            <td><a href="{% static "images/apples.png" %}"><img#}
{#                                                    class="img-responsive" height="50"#}
{#                                                    src="{% static "images/apples.png" %}"></a></td>#}
{#                                            <td><input type="checkbox"></td>#}
{#                                            {% if players == '2' or players == '3' %}#}
{#                                                <td><input type="checkbox"></td>#}
{#                                            {% endif %}#}
{#                                            {% if players == '3' %}#}
{#                                                <td><input type="checkbox"></td>#}
{#                                            {% endif %}#}
{#                                        </tr>#}
{#                                    {% endfor %}#}

                                    <tr class="border-top">
                                        <th>Audio</th>
                                        <th>Screen 1</th>
                                        {% if players == '2' or players == '3' %}
                                            <th>Screen 2</th>
                                        {% endif %}
                                        {% if players == '3' %}
                                            <th>Screen 3</th>
                                        {% endif %}
                                    </tr>

                                    {# AUDIO #}
{#                                    {% for v in '123'|make_list %}#}
{#                                        <tr>#}
{#                                            <td>#}
{#                                                <audio controls>#}
{#                                                    <source src="https://tutorialehtml.com/assets_tutorials/media/Loreena_Mckennitt_Snow_56bit.mp3"#}
{#                                                            type="audio/mpeg">#}
{#                                                    <source src="https://tutorialehtml.com/assets_tutorials/media/Loreena_Mckennitt_Snow_56bit.ogg"#}
{#                                                            type="audio/ogg">#}
{#                                                    Your browser does not support the audio tag.#}
{#                                                </audio>#}
{#                                            </td>#}
{#                                            <td><input type="checkbox"></td>#}
{#                                            {% if players == '2' or players == '3' %}#}
{#                                                <td><input type="checkbox"></td>#}
{#                                            {% endif %}#}
{#                                            {% if players == '3' %}#}
{#                                                <td><input type="checkbox"></td>#}
{#                                            {% endif %}#}
{#                                        </tr>#}
{#                                    {% endfor %}#}

                                    </tbody>
                                </table>
                            </div>
                        </div>


                    </div>
                </div>
            {% endfor %}
        {% endif %}

    </div>


{% endblock %}

{% block base_internal_scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"
            integrity="sha256-FEqEelWI3WouFOo2VWP/uJfs1y8KJ++FLh2Lbqc8SJk=" crossorigin="anonymous"></script>

{% endblock %}

{% block base_external_scripts %}
    <script>
        $(document).ready(function () {

            $('#submission_control_body #submission_control').click(function () {
                let question = $(this).data('questionid');
                let value = $(this).val();

                $.post("/c/api/change/quiz/question/submission/status/" + question + "/",
                    {
                        screen_id: value,
                    }, function (data, status) {
                        if (data.success === "False") {
                            alert("Failed to update record: make sure everything is correct");
                        }
                    });
                ;
            });

            $('#desc-div #choice_control').click(function () {
                let choice_id = $(this).data('choice');
                let screen_id = $(this).data('screen');
                let is_checked = $(this).is(":checked");

                $.post("/c/api/change/quiz/question/choice/status/" + choice_id + "/",
                    {
                        screen_id: screen_id,
                        is_checked: is_checked,

                    }, function (data, status) {
                        if (data.success === "False") {
                            alert("Failed to update record: make sure everything is correct");
                        }
                    });
                ;
            });

             $('#desc-div #statement_control').click(function () {
                let statement_id = $(this).data('statement');
                let screen_id = $(this).data('screen');
                let is_checked = $(this).is(":checked");

                $.post("/c/api/change/quiz/question/statement/status/" + statement_id + "/",
                    {
                        screen_id: screen_id,
                        is_checked: is_checked,

                    }, function (data, status) {
                    if (data.success === "False") {
                            alert("Failed to update record: make sure everything is correct");
                        }
                    });
                ;
            });

        });
    </script>

{% endblock %}

